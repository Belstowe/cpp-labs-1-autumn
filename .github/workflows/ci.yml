name: CI

# Controls when the workflow will run
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  # Allows to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  style:
    # Checks the code style
    runs-on: ubuntu-latest
    
    steps:
      # Checks-out the repository under $GITHUB_WORKSPACE, so the job can access it
      - name: Checkout
        uses: actions/checkout@v2
      
      # Checks for code to follow LLVM format using clang-format
      - name: Check code style
        run: find src/ tests/ -regex '.*\.\(cpp\|hpp\|h\)' -exec clang-format -style=file -i {} \; && git diff --exit-code


  build-linux:
    # Making on a Linux distribution
    runs-on: ubuntu-latest

    steps:
      # Checks-out the repository under $GITHUB_WORKSPACE, so the job can access it
      - name: Checkout
        uses: actions/checkout@v2

      # Exports CC and CXX to tell CMake which compiler to use; runs CMake and make
      - name: Run CMake with Clang
        env:
          CC: clang
          CXX: clang++
        run: |
          mkdir build
          cd build && cmake .. && make
          
      # Runs tests on Linux
      - name: Test
        run: ./build/calc_test